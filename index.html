<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Tap Flight</title>
  <meta name="theme-color" content="#14131a" />
  <style>
    :root{
      --bg0:#14131a;
      --bg1:#1b1a22;
      --panel:#232230;
      --panel2:#1f1e2a;
      --stroke:rgba(255,255,255,.10);
      --stroke2:rgba(255,255,255,.14);

      --text:#f4eeff;
      --muted:#b8add2;
      --muted2:#a198b8;

      --teal:#1fc7d4;
      --purple:#a881fc;
      --green:#31d0aa;
      --pink:#ed4b9e;

      --shadow: 0 14px 44px rgba(0,0,0,.45);
      --radius-xl: 22px;
      --radius-lg: 18px;
      --radius-md: 14px;
      --radius-sm: 12px;
      --pill: 999px;

      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bot: env(safe-area-inset-bottom, 0px);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 20% -10%, rgba(168,129,252,.25), transparent 55%),
        radial-gradient(1000px 700px at 90% 10%, rgba(31,199,212,.22), transparent 52%),
        radial-gradient(1200px 900px at 55% 100%, rgba(237,75,158,.14), transparent 55%),
        linear-gradient(180deg, #15141b 0%, #1a1922 40%, #181720 100%);
      overflow-x:hidden;
    }

    .app{
      min-height:100%;
      padding-bottom: calc(78px + var(--safe-bot));
    }

    /* ======= Sticky header ======= */
    .sticky{
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: blur(14px);
      background: linear-gradient(180deg, rgba(20,19,26,.92) 0%, rgba(20,19,26,.70) 100%);
      border-bottom: 1px solid rgba(255,255,255,.06);
      padding-top: calc(10px + var(--safe-top));
    }

    .wrap{
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 14px;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding: 10px 0 8px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      min-width: 160px;
    }

    .logo{
      width:38px;height:38px;border-radius: 14px;
      background:
        radial-gradient(18px 18px at 28% 30%, rgba(255,255,255,.18), transparent 60%),
        linear-gradient(135deg, rgba(31,199,212,.95), rgba(168,129,252,.95));
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      display:grid; place-items:center;
      border: 1px solid rgba(255,255,255,.18);
      flex:0 0 auto;
    }
    .logo svg{filter: drop-shadow(0 6px 14px rgba(0,0,0,.35))}
    .brand h1{
      margin:0;
      font-size:16px;
      line-height:1.1;
      letter-spacing: .2px;
    }
    .brand .sub{
      margin-top:2px;
      font-size:12px;
      color: var(--muted);
      opacity:.9;
    }

    .actions{
      display:flex;
      align-items:center;
      gap:10px;
    }

    .pill{
      display:flex;
      align-items:center;
      gap:8px;
      padding: 8px 10px;
      border-radius: var(--pill);
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      color: var(--text);
      font-weight: 600;
      font-size: 12.5px;
      cursor:pointer;
      user-select:none;
      transition: transform .08s ease, background .12s ease, border-color .12s ease;
    }
    .pill:active{transform: translateY(1px)}
    .pill:hover{background: rgba(255,255,255,.075); border-color: rgba(255,255,255,.14)}

    .pill .dot{
      width:10px;height:10px;border-radius:999px;
      background: linear-gradient(135deg, var(--teal), var(--purple));
      box-shadow: 0 0 0 3px rgba(31,199,212,.12);
    }
    .pill .chev{opacity:.8}

    .btn{
      border:0;
      border-radius: var(--pill);
      padding: 10px 14px;
      font-weight: 800;
      letter-spacing: .2px;
      cursor:pointer;
      user-select:none;
      transition: transform .08s ease, filter .15s ease;
      box-shadow: 0 12px 34px rgba(0,0,0,.35);
      white-space: nowrap;
    }
    .btn:active{transform: translateY(1px)}
    .btn.teal{
      color:#061316;
      background: linear-gradient(135deg, rgba(31,199,212,1), rgba(31,199,212,.78));
    }

    .iconbtn{
      width:40px;height:40px;border-radius: 14px;
      display:grid; place-items:center;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      cursor:pointer;
      transition: transform .08s ease, background .12s ease;
    }
    .iconbtn:active{transform: translateY(1px)}
    .iconbtn:hover{background: rgba(255,255,255,.075)}
    .iconbtn svg{opacity:.95}

    /* ======= Tabs ======= */
    .tabs{
      display:flex;
      gap:18px;
      padding: 6px 0 10px;
      align-items:flex-end;
    }
    .tab{
      position:relative;
      font-weight: 800;
      font-size: 13px;
      color: var(--muted);
      cursor:pointer;
      padding: 10px 2px;
      user-select:none;
    }
    .tab.active{
      color: var(--text);
    }
    .tab.active::after{
      content:"";
      position:absolute; left:0; right:0; bottom:0;
      height:3px;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--teal), var(--purple));
    }

    /* ======= Pair row ======= */
    .pairRow{
      display:flex;
      gap:12px;
      align-items:center;
      padding: 8px 0 14px;
    }
    .pairMain{
      flex:1;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: var(--pill);
      padding: 10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      box-shadow: 0 10px 28px rgba(0,0,0,.22);
      min-height: 46px;
    }
    .pairLeft{
      display:flex; align-items:center; gap:10px;
      min-width: 0;
    }
    .pairIcon{
      width:30px;height:30px;border-radius: 12px;
      background: linear-gradient(135deg, rgba(168,129,252,.9), rgba(31,199,212,.9));
      border: 1px solid rgba(255,255,255,.14);
      display:grid;place-items:center;
      flex:0 0 auto;
    }
    .pairText{min-width:0}
    .pairTicker{
      font-weight:900;
      font-size: 13px;
      letter-spacing:.2px;
      white-space:nowrap;
    }
    .pairPrice{
      color: var(--muted);
      font-weight: 800;
      font-size: 12px;
      margin-top: 2px;
      white-space:nowrap;
    }
    .pairRight{
      display:flex; align-items:center; gap:8px;
      flex:0 0 auto;
      color: var(--muted);
      font-weight: 900;
      font-size: 12px;
    }
    .chip{
      padding: 6px 10px;
      border-radius: var(--pill);
      background: rgba(0,0,0,.22);
      border: 1px solid rgba(255,255,255,.08);
      color: var(--muted);
      font-weight: 900;
      font-size: 12px;
      white-space:nowrap;
    }

    .pairMini{
      width:46px;height:46px;border-radius: 18px;
      display:grid;place-items:center;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      cursor:pointer;
      transition: transform .08s ease, background .12s ease;
    }
    .pairMini:active{transform: translateY(1px)}
    .pairMini:hover{background: rgba(255,255,255,.075)}
    .pairMini span{
      font-size: 12px;
      font-weight: 1000;
      color: var(--muted);
    }

    /* ======= Timer row ======= */
    .metaRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding-bottom: 10px;
    }
    .timerPack{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .timerPill{
      display:flex; align-items:center; gap:8px;
      padding: 8px 10px;
      border-radius: var(--pill);
      background: rgba(0,0,0,.22);
      border: 1px solid rgba(255,255,255,.08);
      font-weight: 1000;
      letter-spacing: .6px;
      font-size: 12.5px;
    }
    .timerPill .clock{opacity:.9}
    .smallTag{
      font-weight: 900;
      font-size: 12px;
      color: var(--muted);
      display:flex; align-items:center; gap:6px;
      padding: 8px 10px;
      border-radius: var(--pill);
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
    }
    .quickBtns{
      display:flex; gap:10px;
    }

    /* ======= Main content ======= */
    .content{
      padding: 14px 0 24px;
    }

    .hero{
      margin-top: 8px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.04));
      border: 1px solid rgba(255,255,255,.10);
      border-radius: var(--radius-xl);
      padding: 12px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      box-shadow: 0 10px 30px rgba(0,0,0,.20);
    }
    .hero .bal{
      display:flex; flex-direction:column; gap:4px;
      min-width: 0;
    }
    .hero .bal .label{color: var(--muted); font-size: 12px; font-weight: 900}
    .hero .bal .value{font-size: 16px; font-weight: 1000; letter-spacing:.2px}
    .hero .hint{
      color: var(--muted2);
      font-size: 12px;
      font-weight: 800;
      text-align:right;
      line-height:1.25;
    }

    /* ======= Carousel ======= */
    .carousel{
      margin-top: 14px;
      display:flex;
      gap:14px;
      overflow-x:auto;
      scroll-snap-type: x mandatory;
      padding: 6px 10px 18px;
      -webkit-overflow-scrolling: touch;
    }
    .carousel::-webkit-scrollbar{height:8px}
    .carousel::-webkit-scrollbar-thumb{
      background: rgba(255,255,255,.12);
      border-radius: 999px;
    }

    .card{
      flex: 0 0 auto;
      width: min(360px, 86vw);
      border-radius: var(--radius-xl);
      position:relative;
      scroll-snap-align: center;
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.04));
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card::before{
      content:"";
      position:absolute; inset:-2px;
      background: linear-gradient(180deg, rgba(31,199,212,.65), rgba(168,129,252,.55));
      filter: blur(12px);
      opacity:.35;
      pointer-events:none;
    }
    .cardInner{
      position:relative;
      padding: 14px;
    }

    .cardHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom: 10px;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 7px 10px;
      border-radius: var(--pill);
      font-weight: 1000;
      letter-spacing:.35px;
      font-size: 11px;
      text-transform: uppercase;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.22);
    }
    .badge .dot{
      width:8px;height:8px;border-radius:999px;
      background: var(--muted);
      opacity:.9;
    }
    .badge.live .dot{background: var(--teal); box-shadow: 0 0 0 4px rgba(31,199,212,.18)}
    .badge.next .dot{background: var(--purple); box-shadow: 0 0 0 4px rgba(168,129,252,.16)}
    .badge.later .dot{background: rgba(255,255,255,.5)}
    .badge.end .dot{background: var(--pink); box-shadow: 0 0 0 4px rgba(237,75,158,.14)}

    .roundId{
      font-weight: 1000;
      color: var(--muted);
      font-size: 12px;
      white-space:nowrap;
    }

    .panel{
      border-radius: var(--radius-lg);
      background: rgba(0,0,0,.22);
      border: 1px solid rgba(255,255,255,.08);
      padding: 12px;
    }

    .labelRow{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:10px;
      margin-bottom: 8px;
    }
    .labelRow .k{color: var(--muted); font-size: 12px; font-weight: 900}
    .labelRow .delta{
      font-weight: 1000;
      font-size: 12px;
      padding: 6px 10px;
      border-radius: var(--pill);
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      white-space:nowrap;
    }

    .priceBig{
      font-size: 26px;
      font-weight: 1100;
      letter-spacing: .2px;
    }

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top: 10px;
    }
    .kv{
      border-radius: var(--radius-md);
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      padding: 10px;
    }
    .kv .k{color: var(--muted); font-size: 11.5px; font-weight: 900}
    .kv .v{margin-top:4px; font-weight: 1000; font-size: 13.5px}

    .progress{
      height: 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.10);
      overflow:hidden;
      margin-top: 12px;
    }
    .bar{
      height:100%;
      width: 30%;
      background: linear-gradient(90deg, var(--teal), var(--purple));
      border-radius: 999px;
    }

    .ctaRow{
      display:flex;
      gap:10px;
      margin-top: 12px;
    }
    .cta{
      flex:1;
      border:0;
      border-radius: 16px;
      padding: 12px 12px;
      font-weight: 1000;
      cursor:pointer;
      transition: transform .08s ease, filter .15s ease;
      letter-spacing: .2px;
    }
    .cta:active{transform: translateY(1px)}
    .cta.up{background: linear-gradient(135deg, rgba(49,208,170,1), rgba(49,208,170,.70)); color:#061316}
    .cta.down{background: linear-gradient(135deg, rgba(237,75,158,1), rgba(237,75,158,.72)); color:#1a0612}

    .footerHint{
      margin-top: 10px;
      color: var(--muted2);
      font-size: 12px;
      font-weight: 800;
      line-height: 1.3;
    }

    /* ======= Fixed badge ======= */
    .chainBadge{
      position:fixed;
      right: 14px;
      bottom: calc(86px + var(--safe-bot));
      z-index: 60;
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border-radius: 16px;
      background: rgba(20,19,26,.72);
      border: 1px solid rgba(255,255,255,.12);
      backdrop-filter: blur(12px);
      box-shadow: 0 14px 40px rgba(0,0,0,.35);
      max-width: min(280px, 78vw);
    }
    .chainBadge .t{
      font-size: 11.5px;
      font-weight: 900;
      color: var(--muted);
      line-height: 1.2;
    }
    .chainBadge .t b{color: var(--text)}
    .chainBadge svg{flex:0 0 auto; opacity:.95}

    /* ======= Bottom nav ======= */
    .bottomNav{
      position:fixed;
      left:0; right:0; bottom:0;
      z-index: 70;
      background: rgba(20,19,26,.88);
      backdrop-filter: blur(14px);
      border-top: 1px solid rgba(255,255,255,.08);
      padding-bottom: var(--safe-bot);
    }
    .navRow{
      display:flex;
      justify-content:space-around;
      align-items:center;
      padding: 10px 10px 12px;
    }
    .navItem{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:6px;
      color: var(--muted);
      font-weight: 900;
      font-size: 11px;
      cursor:pointer;
      user-select:none;
      min-width: 68px;
    }
    .navItem .ico{
      width:42px; height:34px;
      border-radius: 14px;
      display:grid; place-items:center;
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.08);
    }
    .navItem.active{
      color: var(--text);
    }
    .navItem.active .ico{
      background: linear-gradient(135deg, rgba(31,199,212,.20), rgba(168,129,252,.16));
      border-color: rgba(31,199,212,.28);
    }

    /* ======= Modal ======= */
    .modalBack{
      position:fixed; inset:0;
      z-index: 90;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:flex-end;
      justify-content:center;
      padding: 14px;
      padding-bottom: calc(14px + var(--safe-bot));
    }
    .modalBack.show{display:flex}
    .modal{
      width: min(520px, 100%);
      border-radius: 22px;
      background: linear-gradient(180deg, rgba(35,34,48,.98), rgba(27,26,34,.98));
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 30px 90px rgba(0,0,0,.65);
      overflow:hidden;
    }
    .modalHead{
      padding: 14px 14px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .modalHead .title{
      font-weight: 1100;
      letter-spacing:.2px;
    }
    .xbtn{
      width:40px;height:40px;border-radius:14px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      display:grid;place-items:center;
      cursor:pointer;
    }
    .modalBody{padding: 14px}
    .row{
      display:flex; justify-content:space-between; align-items:center; gap:12px;
      margin-bottom: 10px;
    }
    .row .k{color: var(--muted); font-weight: 900; font-size: 12px}
    .row .v{font-weight: 1000; font-size: 12.5px}

    .chips{
      display:flex; flex-wrap:wrap; gap:10px;
      margin: 12px 0;
    }
    .chipBtn{
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: var(--text);
      border-radius: 999px;
      padding: 10px 12px;
      font-weight: 1000;
      cursor:pointer;
    }
    .chipBtn.active{
      border-color: rgba(31,199,212,.35);
      background: rgba(31,199,212,.14);
    }

    .input{
      width:100%;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
      padding: 12px 12px;
      color: var(--text);
      font-weight: 1000;
      outline:none;
      font-size: 14px;
    }

    .modalActions{
      display:flex;
      gap:10px;
      padding: 14px;
      border-top: 1px solid rgba(255,255,255,.08);
    }
    .modalActions .btn2{
      flex:1;
      border:0;
      border-radius: 16px;
      padding: 12px;
      font-weight: 1100;
      cursor:pointer;
    }
    .btn2.ghost{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      color: var(--text);
    }
    .btn2.primary{
      background: linear-gradient(135deg, rgba(31,199,212,1), rgba(168,129,252,.95));
      color: #061316;
    }

    /* ======= Toast ======= */
    .toast{
      position:fixed;
      left:50%;
      transform: translateX(-50%);
      bottom: calc(98px + var(--safe-bot));
      z-index: 95;
      background: rgba(20,19,26,.82);
      border: 1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(12px);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 16px;
      max-width: min(560px, 92vw);
      box-shadow: 0 18px 60px rgba(0,0,0,.45);
      display:none;
      font-weight: 900;
      font-size: 12.5px;
    }
    .toast.show{display:block}

    /* ======= History ======= */
    .history{
      padding: 12px 0 0;
    }
    .hCard{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: var(--radius-xl);
      padding: 14px;
      box-shadow: 0 10px 30px rgba(0,0,0,.20);
      margin-bottom: 12px;
    }
    .hRow{
      display:flex;
      justify-content:space-between;
      gap:10px;
      margin-top: 8px;
      color: var(--muted);
      font-weight: 900;
      font-size: 12px;
    }
    .hRow b{color: var(--text)}
    .pillSmall{
      display:inline-flex; align-items:center; gap:8px;
      border-radius: 999px;
      padding: 6px 10px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.22);
      font-weight: 1000;
      font-size: 11px;
      white-space:nowrap;
    }

    .sep{
      height:1px;
      background: rgba(255,255,255,.08);
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <div class="app">

    <div class="sticky">
      <div class="wrap">
        <div class="topbar">
          <div class="brand">
            <div class="logo" aria-hidden="true">
              <!-- paper-plane icon -->
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M21.8 3.3L2.7 10.9c-.8.3-.7 1.5.2 1.7l7.2 1.6 1.6 7.2c.2.9 1.4 1 1.7.2l7.6-19.1c.2-.6-.4-1.2-1-1z" stroke="white" stroke-width="2" stroke-linejoin="round"/>
                <path d="M10 14l11-10" stroke="white" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </div>
            <div>
              <h1>Tap Flight</h1>
              <div class="sub" id="subline">Prediction ‚Ä¢ demo</div>
            </div>
          </div>

          <div class="actions">
            <button class="iconbtn" id="btnHelp" title="–°–ø—Ä–∞–≤–∫–∞">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                <path d="M12 18h.01" stroke="white" stroke-width="2" stroke-linecap="round"/>
                <path d="M9.1 9a3 3 0 1 1 4.7 2.6c-.9.5-1.8 1.2-1.8 2.4v.5" stroke="white" stroke-width="2" stroke-linecap="round"/>
                <path d="M12 22c5.5 0 10-4.5 10-10S17.5 2 12 2 2 6.5 2 12s4.5 10 10 10z" stroke="white" stroke-width="2"/>
              </svg>
            </button>

            <button class="pill" id="btnNetwork" title="–°–µ—Ç—å (–∑–∞–≥–ª—É—à–∫–∞)">
              <span class="dot"></span>
              <span id="netName">BSC</span>
              <span class="chev">‚ñæ</span>
            </button>

            <button class="btn teal" id="btnConnect">–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</button>
          </div>
        </div>

        <div class="tabs">
          <div class="tab active" id="tabPlay">–ü–æ–ª—ë—Ç</div>
          <div class="tab" id="tabHistory">–ò—Å—Ç–æ—Ä–∏—è</div>
        </div>

        <div class="pairRow">
          <div class="pairMain" id="pairMain">
            <div class="pairLeft">
              <div class="pairIcon" aria-hidden="true">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                  <path d="M12 2l7 4v12l-7 4-7-4V6l7-4z" stroke="white" stroke-width="2" stroke-linejoin="round"/>
                  <path d="M12 2v20" stroke="white" stroke-width="2" opacity=".6"/>
                </svg>
              </div>
              <div class="pairText">
                <div class="pairTicker" id="pairTicker">BNB / USD</div>
                <div class="pairPrice" id="pairPrice">$0.00</div>
              </div>
            </div>
            <div class="pairRight">
              <span class="chip" id="pairFeed">Live (demo)</span>
            </div>
          </div>

          <button class="pairMini" data-pair="BNBUSD" title="BNB"><span>BNB</span></button>
          <button class="pairMini" data-pair="ETHUSD" title="ETH"><span>ETH</span></button>
        </div>

        <div class="metaRow">
          <div class="timerPack">
            <div class="timerPill" id="timerPill">
              <span class="clock">‚è±</span>
              <span id="timerText">00:00</span>
            </div>
            <div class="smallTag" title="–î–ª–∏–Ω–∞ —Ä–∞—É–Ω–¥–∞">
              <span>‚úàÔ∏è</span>
              <span>5 –º–∏–Ω</span>
            </div>
          </div>

          <div class="quickBtns">
            <button class="iconbtn" id="btnTrophy" title="–†–µ–π—Ç–∏–Ω–≥ (–∑–∞–≥–ª—É—à–∫–∞)">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                <path d="M8 4h8v3a4 4 0 0 1-8 0V4z" stroke="white" stroke-width="2"/>
                <path d="M6 5H4a2 2 0 0 0 2 4" stroke="white" stroke-width="2" stroke-linecap="round"/>
                <path d="M18 5h2a2 2 0 0 1-2 4" stroke="white" stroke-width="2" stroke-linecap="round"/>
                <path d="M12 11v3" stroke="white" stroke-width="2" stroke-linecap="round"/>
                <path d="M9 21h6" stroke="white" stroke-width="2" stroke-linecap="round"/>
                <path d="M10 14h4v7h-4z" stroke="white" stroke-width="2"/>
              </svg>
            </button>
          </div>
        </div>

      </div>
    </div>

    <div class="wrap">
      <div class="content" id="screenPlay">
        <div class="hero">
          <div class="bal">
            <div class="label">–ë–∞–ª–∞–Ω—Å (demo)</div>
            <div class="value" id="balanceText">0 TF</div>
          </div>
          <div class="hint">
            –°—Ç–∞–≤—å –Ω–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã.<br/>
            –í—ã–ø–ª–∞—Ç–∞: <b>1.95√ó</b> –ø—Ä–∏ –≤—ã–∏–≥—Ä—ã—à–µ
          </div>
        </div>

        <div class="carousel" id="carousel"></div>

        <div class="footerHint" id="footerHint"></div>
      </div>

      <div class="content" id="screenHistory" style="display:none;">
        <div class="history" id="historyList"></div>
      </div>
    </div>

    <div class="chainBadge" title="–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö (–¥–µ–º–æ)">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
        <path d="M7 7h10v10H7V7z" stroke="white" stroke-width="2"/>
        <path d="M4 4h3M17 4h3M4 20h3M17 20h3" stroke="white" stroke-width="2" stroke-linecap="round" opacity=".7"/>
      </svg>
      <div class="t"><b>Market Data</b><br/>secured (demo)</div>
    </div>

    <div class="bottomNav">
      <div class="navRow">
        <div class="navItem active" id="navPlay">
          <div class="ico" aria-hidden="true">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M3 12l9-9 9 9v8a1 1 0 0 1-1 1h-5v-7H9v7H4a1 1 0 0 1-1-1v-8z" stroke="white" stroke-width="2" stroke-linejoin="round"/>
            </svg>
          </div>
          –ü–æ–ª—ë—Ç
        </div>
        <div class="navItem" id="navHistory">
          <div class="ico" aria-hidden="true">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M3 12a9 9 0 1 0 3-6.7" stroke="white" stroke-width="2" stroke-linecap="round"/>
              <path d="M3 4v5h5" stroke="white" stroke-width="2" stroke-linecap="round"/>
              <path d="M12 7v6l4 2" stroke="white" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </div>
          –ò—Å—Ç–æ—Ä–∏—è
        </div>
        <div class="navItem" id="navEarn">
          <div class="ico" aria-hidden="true">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M12 2l4 7-4 2-4-2 4-7z" stroke="white" stroke-width="2" stroke-linejoin="round"/>
              <path d="M6 11l6 11 6-11" stroke="white" stroke-width="2" stroke-linejoin="round"/>
            </svg>
          </div>
          –ù–∞–≥—Ä–∞–¥—ã
        </div>
        <div class="navItem" id="navMe">
          <div class="ico" aria-hidden="true">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M20 21a8 8 0 0 0-16 0" stroke="white" stroke-width="2" stroke-linecap="round"/>
              <path d="M12 11a4 4 0 1 0-4-4 4 4 0 0 0 4 4z" stroke="white" stroke-width="2"/>
            </svg>
          </div>
          –ü—Ä–æ—Ñ–∏–ª—å
        </div>
      </div>
    </div>

    <!-- Modal -->
    <div class="modalBack" id="modalBack">
      <div class="modal" role="dialog" aria-modal="true">
        <div class="modalHead">
          <div class="title" id="modalTitle">–°—Ç–∞–≤–∫–∞</div>
          <div class="xbtn" id="modalClose" title="–ó–∞–∫—Ä—ã—Ç—å">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M6 6l12 12M18 6L6 18" stroke="white" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </div>
        </div>
        <div class="modalBody" id="modalBody"></div>
        <div class="modalActions" id="modalActions"></div>
      </div>
    </div>

    <div class="toast" id="toast"></div>
  </div>

  <script>
    // ===== Telegram WebApp integration (safe fallback) =====
    const TG = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
    try{
      if (TG) { TG.ready(); TG.expand(); }
    }catch(e){}

    // ===== Helpers =====
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));

    const clamp = (n, a, b) => Math.max(a, Math.min(b, n));
    const fmt2 = (n) => Number(n).toFixed(2);
    const pad2 = (n) => String(n).padStart(2,"0");
    const mmss = (sec) => `${pad2(Math.floor(sec/60))}:${pad2(sec%60)}`;

    function toast(msg){
      const t = $("#toast");
      t.textContent = msg;
      t.classList.add("show");
      clearTimeout(toast._tm);
      toast._tm = setTimeout(()=>t.classList.remove("show"), 2400);
    }

    // ===== Storage =====
    const KEY = "tapflight.v1";
    function loadState(){
      try{
        const raw = localStorage.getItem(KEY);
        if(!raw) return null;
        return JSON.parse(raw);
      }catch(e){ return null; }
    }
    function saveState(){
      localStorage.setItem(KEY, JSON.stringify(state));
    }

    // ===== Core model =====
    const ROUND_SEC = 5 * 60;          // 5 minutes
    const PAYOUT = 1.95;               // demo payout
    const BETTING_BUFFER = 8;          // seconds before round flips to avoid edge
    const DEFAULT_BAL = 500;           // demo tokens
    const PAIRS = {
      BNBUSD: { name:"BNB / USD", seed: 320, vol: 0.8 },
      ETHUSD: { name:"ETH / USD", seed: 2200, vol: 3.2 },
    };

    // Restore or init state
    const state = loadState() || {
      pair: "BNBUSD",
      balance: DEFAULT_BAL,
      price: PAIRS.BNBUSD.seed,
      // results by roundId: { open, close, startTs, endTs, dir, settledAt }
      results: {},
      // bets: [{ id, roundId, dir, amount, entryPrice, placedAt, settled, win, payout }]
      bets: [],
      // ui
      lastSeenRoundId: null
    };

    // ===== Price simulator =====
    function stepPrice(){
      const pair = PAIRS[state.pair];
      // random walk with slight mean reversion
      const drift = (pair.seed - state.price) * 0.0008;
      const noise = (Math.random() - 0.5) * pair.vol;
      state.price = Math.max(0.01, state.price + drift + noise);
    }

    // ===== Round math (based on epoch buckets) =====
    function roundFor(tsMs){
      const ts = Math.floor(tsMs / 1000);
      const start = Math.floor(ts / ROUND_SEC) * ROUND_SEC;
      const end = start + ROUND_SEC;
      const id = start; // simple roundId
      return { id, start, end };
    }

    function ensureRoundResult(round){
      if(!state.results[round.id]){
        state.results[round.id] = {
          open: state.price,
          close: null,
          startTs: round.start,
          endTs: round.end,
          dir: null,
          settledAt: null
        };
      }
    }

    function settleRoundIfNeeded(prevRound, nowSec){
      const r = state.results[prevRound.id];
      if(!r) return;
      if(r.close != null) return;

      // close when time passed end
      if(nowSec >= prevRound.end){
        r.close = state.price;
        r.dir = (r.close > r.open) ? "UP" : (r.close < r.open ? "DOWN" : "FLAT");
        r.settledAt = nowSec;

        // settle bets
        for(const b of state.bets){
          if(b.roundId !== prevRound.id) continue;
          if(b.settled) continue;

          let win = false;
          if(r.dir === "FLAT"){
            win = false; // treat flat as loss in demo
          } else {
            win = (b.dir === r.dir);
          }

          b.settled = true;
          b.win = win;
          b.closePrice = r.close;
          b.payout = win ? +(b.amount * PAYOUT).toFixed(2) : 0;

          if(win){
            state.balance = +(state.balance + b.payout).toFixed(2);
          }
        }

        saveState();
        toast(`–†–∞—É–Ω–¥ –∑–∞–≤–µ—Ä—à—ë–Ω ‚Ä¢ ${r.dir === "UP" ? "–í–í–ï–†–•" : r.dir === "DOWN" ? "–í–ù–ò–ó" : "–§–õ–≠–¢"}`);
      }
    }

    // ===== UI refs =====
    const el = {
      btnConnect: $("#btnConnect"),
      btnNetwork: $("#btnNetwork"),
      btnHelp: $("#btnHelp"),
      btnTrophy: $("#btnTrophy"),
      pairTicker: $("#pairTicker"),
      pairPrice: $("#pairPrice"),
      balanceText: $("#balanceText"),
      timerText: $("#timerText"),
      carousel: $("#carousel"),
      footerHint: $("#footerHint"),
      subline: $("#subline"),
      // screens
      tabPlay: $("#tabPlay"),
      tabHistory: $("#tabHistory"),
      navPlay: $("#navPlay"),
      navHistory: $("#navHistory"),
      screenPlay: $("#screenPlay"),
      screenHistory: $("#screenHistory"),
      historyList: $("#historyList"),
      // modal
      modalBack: $("#modalBack"),
      modalTitle: $("#modalTitle"),
      modalBody: $("#modalBody"),
      modalActions: $("#modalActions"),
      modalClose: $("#modalClose")
    };

    // ===== Connect button label =====
    function updateConnectLabel(){
      if (TG && TG.initDataUnsafe && TG.initDataUnsafe.user){
        const u = TG.initDataUnsafe.user;
        el.btnConnect.textContent = u.first_name ? `–ü—Ä–∏–≤–µ—Ç, ${u.first_name}` : "–û—Ç–∫—Ä—ã—Ç–æ";
        el.subline.textContent = "Prediction ‚Ä¢ –≤–Ω—É—Ç—Ä–∏ Telegram";
      } else {
        el.btnConnect.textContent = "–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è";
        el.subline.textContent = "Prediction ‚Ä¢ demo";
      }
    }

    // ===== Modal helpers =====
    function openModal(title, bodyHtml, actions){
      el.modalTitle.textContent = title;
      el.modalBody.innerHTML = bodyHtml;
      el.modalActions.innerHTML = "";
      for(const a of actions){
        const b = document.createElement("button");
        b.className = `btn2 ${a.kind || "ghost"}`;
        b.textContent = a.text;
        b.onclick = a.onClick;
        el.modalActions.appendChild(b);
      }
      el.modalBack.classList.add("show");
    }
    function closeModal(){ el.modalBack.classList.remove("show"); }
    el.modalClose.onclick = closeModal;
    el.modalBack.addEventListener("click", (e)=>{ if(e.target === el.modalBack) closeModal(); });

    // ===== Betting UI =====
    function openBetModal(dir, targetRound){
      const max = Math.floor(state.balance);
      const preset = [10, 25, 50, 100, 250].filter(x => x <= Math.max(10, max));
      let chosen = preset[0] || Math.min(10, max);
      const dirLabel = dir === "UP" ? "–í–í–ï–†–•" : "–í–ù–ò–ó";
      const color = dir === "UP" ? "var(--green)" : "var(--pink)";

      const body = `
        <div class="row">
          <div class="k">–†–∞—É–Ω–¥</div>
          <div class="v">#${targetRound.id}</div>
        </div>
        <div class="row">
          <div class="k">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div>
          <div class="v" style="color:${color}; font-weight:1100">${dirLabel}</div>
        </div>
        <div class="row">
          <div class="k">–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞</div>
          <div class="v">$${fmt2(state.price)}</div>
        </div>
        <div class="sep"></div>
        <div class="row">
          <div class="k">–°—É–º–º–∞ (TF)</div>
          <div class="v">–î–æ—Å—Ç—É–ø–Ω–æ: <b>${fmt2(state.balance)}</b></div>
        </div>
        <div class="chips" id="chipWrap">
          ${preset.map(v=>`<button class="chipBtn" data-v="${v}">${v} TF</button>`).join("")}
        </div>
        <input class="input" id="amtInput" inputmode="decimal" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 25" value="${chosen}" />
        <div class="footerHint" style="margin-top:10px;">
          –í—ã–∏–≥—Ä—ã—à = —Å—Ç–∞–≤–∫–∞ √ó <b>${PAYOUT}</b> (demo). –ü—Ä–∏ FLAT ‚Äî –ø—Ä–æ–∏–≥—Ä—ã—à (demo).
        </div>
      `;

      openModal(`–°—Ç–∞–≤–∫–∞: ${dirLabel}`, body, [
        { kind:"ghost", text:"–û—Ç–º–µ–Ω–∞", onClick: closeModal },
        { kind:"primary", text:"–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å", onClick: ()=>confirmBet(dir, targetRound.id) }
      ]);

      const chipWrap = $("#chipWrap");
      const amtInput = $("#amtInput");

      function syncActive(){
        $$("#chipWrap .chipBtn").forEach(b=>{
          b.classList.toggle("active", Number(b.dataset.v) === chosen);
        });
        amtInput.value = String(chosen);
      }

      chipWrap.addEventListener("click", (e)=>{
        const btn = e.target.closest(".chipBtn");
        if(!btn) return;
        chosen = Number(btn.dataset.v);
        syncActive();
      });

      amtInput.addEventListener("input", ()=>{
        const val = Number(String(amtInput.value).replace(",", "."));
        if(Number.isFinite(val)){
          chosen = clamp(val, 0, 1e9);
          syncActive();
        }
      });

      syncActive();

      function confirmBet(dir, roundId){
        const val = Number(String($("#amtInput").value).replace(",", "."));
        const amount = Math.floor(val * 100) / 100;
        if(!Number.isFinite(amount) || amount <= 0){
          toast("–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –±–æ–ª—å—à–µ 0");
          return;
        }
        if(amount > state.balance){
          toast("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–∞–Ω—Å–∞");
          return;
        }

        // prevent last seconds
        const nowSec = Math.floor(Date.now()/1000);
        const r = roundFor(Date.now());
        // target is next round; ensure it's still upcoming
        if(roundId !== r.id + ROUND_SEC){
          toast("–≠—Ç–æ—Ç —Ä–∞—É–Ω–¥ —É–∂–µ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω");
          closeModal();
          return;
        }
        if((r.end - nowSec) <= BETTING_BUFFER){
          toast("–°–ª–∏—à–∫–æ–º –ø–æ–∑–¥–Ω–æ ‚Äî –æ—Ç–∫—Ä–æ–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞—É–Ω–¥");
          closeModal();
          return;
        }

        state.balance = +(state.balance - amount).toFixed(2);

        const bet = {
          id: cryptoRandomId(),
          roundId,
          dir,
          amount,
          entryPrice: +state.price.toFixed(2),
          placedAt: nowSec,
          settled: false,
          win: null,
          payout: 0
        };
        state.bets.unshift(bet);
        saveState();
        closeModal();
        toast(`–°—Ç–∞–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞: ${amount} TF ‚Ä¢ ${dir === "UP" ? "–í–í–ï–†–•" : "–í–ù–ò–ó"}`);
        renderAll();
      }
    }

    function cryptoRandomId(){
      try{
        const a = new Uint8Array(8);
        crypto.getRandomValues(a);
        return Array.from(a).map(x=>x.toString(16).padStart(2,"0")).join("");
      }catch{
        return String(Math.random()).slice(2);
      }
    }

    // ===== Render =====
    function renderPlay(){
      const now = Date.now();
      const nowSec = Math.floor(now/1000);

      const active = roundFor(now);
      const next = { id: active.id + ROUND_SEC, start: active.end, end: active.end + ROUND_SEC };
      const later = { id: next.id + ROUND_SEC, start: next.end, end: next.end + ROUND_SEC };
      const prev = { id: active.id - ROUND_SEC, start: active.start - ROUND_SEC, end: active.start };

      // ensure state for active/prev (for settlement)
      ensureRoundResult(active);
      ensureRoundResult(prev);
      // settle previous round (if needed)
      settleRoundIfNeeded(prev, nowSec);

      // timer to end of active
      const left = active.end - nowSec;
      el.timerText.textContent = mmss(Math.max(0, left));
      el.pairTicker.textContent = PAIRS[state.pair].name;
      el.pairPrice.textContent = `$${fmt2(state.price)}`;

      el.balanceText.textContent = `${fmt2(state.balance)} TF`;

      const rActive = state.results[active.id];
      const delta = state.price - rActive.open;
      const deltaPct = rActive.open ? (delta / rActive.open * 100) : 0;
      const dirUp = delta >= 0;

      const pool = calcPoolFor(next.id); // pool for next round based on bets
      const myNextBet = state.bets.find(b => b.roundId === next.id && !b.settled);

      const progress = clamp(1 - (left / ROUND_SEC), 0, 1);
      const progressPct = Math.round(progress * 100);

      const deltaText = `${dirUp ? "‚ñ≤" : "‚ñº"} ${fmt2(Math.abs(delta))} (${fmt2(Math.abs(deltaPct))}%)`;
      const deltaColor = dirUp ? "rgba(49,208,170,.22)" : "rgba(237,75,158,.20)";
      const deltaBorder = dirUp ? "rgba(49,208,170,.35)" : "rgba(237,75,158,.32)";

      const activeCard = `
        <div class="card">
          <div class="cardInner">
            <div class="cardHead">
              <div class="badge live"><span class="dot"></span>–ê–ö–¢–ò–í–ù–û</div>
              <div class="roundId">#${active.id}</div>
            </div>

            <div class="panel">
              <div class="labelRow">
                <div class="k">–ü–û–°–õ–ï–î–ù–Ø–Ø –¶–ï–ù–ê</div>
                <div class="delta" style="background:${deltaColor}; border-color:${deltaBorder}">
                  ${deltaText}
                </div>
              </div>
              <div class="priceBig">$${fmt2(state.price)}</div>

              <div class="grid2">
                <div class="kv">
                  <div class="k">–û—Ç–∫—Ä—ã—Ç–∏–µ</div>
                  <div class="v">$${fmt2(rActive.open)}</div>
                </div>
                <div class="kv">
                  <div class="k">–î–æ –∑–∞–∫—Ä—ã—Ç–∏—è</div>
                  <div class="v">${mmss(Math.max(0,left))}</div>
                </div>
              </div>

              <div class="progress" aria-label="progress">
                <div class="bar" style="width:${progressPct}%"></div>
              </div>

              <div class="footerHint">
                –≠—Ç–æ—Ç —Ä–∞—É–Ω–¥ —É–∂–µ –∏–¥—ë—Ç. –°—Ç–∞–≤–∫–∏ –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è –Ω–∞ <b>—Å–ª–µ–¥—É—é—â–∏–π</b>.
              </div>
            </div>
          </div>
        </div>
      `;

      const nextCard = `
        <div class="card">
          <div class="cardInner">
            <div class="cardHead">
              <div class="badge next"><span class="dot"></span>–°–õ–ï–î–£–Æ–©–ò–ô</div>
              <div class="roundId">#${next.id}</div>
            </div>

            <div class="panel">
              <div class="labelRow">
                <div class="k">–ü–†–ò–ó–û–í–û–ô –ü–£–õ</div>
                <div class="delta" style="background:rgba(31,199,212,.14); border-color:rgba(31,199,212,.26)">
                  ${fmt2(pool.total)} TF
                </div>
              </div>

              <div class="grid2">
                <div class="kv">
                  <div class="k">–í–í–ï–†–•</div>
                  <div class="v">${fmt2(pool.up)} TF</div>
                </div>
                <div class="kv">
                  <div class="k">–í–ù–ò–ó</div>
                  <div class="v">${fmt2(pool.down)} TF</div>
                </div>
              </div>

              <div class="ctaRow">
                <button class="cta up" id="betUp">–ó–∞–Ω—è—Ç—å –í–í–ï–†–•</button>
                <button class="cta down" id="betDown">–ó–∞–Ω—è—Ç—å –í–ù–ò–ó</button>
              </div>

              <div class="footerHint">
                –°—Ç–∞—Ä—Ç —á–µ—Ä–µ–∑ <b>${mmss(Math.max(0, left))}</b>.
                ${myNextBet ? `<br/>–¢–≤–æ—è —Å—Ç–∞–≤–∫–∞: <span class="pillSmall">${myNextBet.dir === "UP" ? "–í–í–ï–†–•" : "–í–ù–ò–ó"} ‚Ä¢ ${fmt2(myNextBet.amount)} TF</span>` : ""}
              </div>
            </div>
          </div>
        </div>
      `;

      const laterCard = `
        <div class="card">
          <div class="cardInner">
            <div class="cardHead">
              <div class="badge later"><span class="dot"></span>–ü–û–ó–ñ–ï</div>
              <div class="roundId">#${later.id}</div>
            </div>

            <div class="panel">
              <div class="labelRow">
                <div class="k">–í–•–û–î –û–¢–ö–†–û–ï–¢–°–Ø</div>
                <div class="delta" style="background:rgba(255,255,255,.06); border-color:rgba(255,255,255,.12)">
                  ~${mmss(Math.max(0, left + ROUND_SEC))}
                </div>
              </div>

              <div class="footerHint">
                –ü–ª–∞–Ω–∏—Ä—É–π —Å–ª–µ–¥—É—é—â–∏–π —Ä–µ–π—Å –∑–∞—Ä–∞–Ω–µ–µ ‚úàÔ∏è
              </div>
            </div>
          </div>
        </div>
      `;

      // last ended (prev) card using stored result if exists
      const rPrev = state.results[prev.id];
      const prevClosed = rPrev && rPrev.close != null;
      const prevDir = prevClosed ? rPrev.dir : null;
      const prevLabel = prevDir === "UP" ? "–í–í–ï–†–•" : prevDir === "DOWN" ? "–í–ù–ò–ó" : "–§–õ–≠–¢";
      const prevColor = prevDir === "UP" ? "rgba(49,208,170,.22)" : "rgba(237,75,158,.20)";
      const prevBorder = prevDir === "UP" ? "rgba(49,208,170,.35)" : "rgba(237,75,158,.32)";

      const expiredCard = `
        <div class="card">
          <div class="cardInner">
            <div class="cardHead">
              <div class="badge end"><span class="dot"></span>${prevClosed ? "–ó–ê–í–ï–†–®–Å–ù" : "–û–ñ–ò–î–ê–ù–ò–ï"}</div>
              <div class="roundId">#${prev.id}</div>
            </div>

            <div class="panel">
              <div class="labelRow">
                <div class="k">–¶–ï–ù–ê –ó–ê–ö–†–´–¢–ò–Ø</div>
                <div class="delta" style="background:${prevColor}; border-color:${prevBorder}">
                  ${prevClosed ? prevLabel : "‚Ä¶" }
                </div>
              </div>

              <div class="grid2">
                <div class="kv">
                  <div class="k">–û—Ç–∫—Ä—ã—Ç–∏–µ</div>
                  <div class="v">${rPrev ? `$${fmt2(rPrev.open)}` : "‚Äî"}</div>
                </div>
                <div class="kv">
                  <div class="k">–ó–∞–∫—Ä—ã—Ç–∏–µ</div>
                  <div class="v">${prevClosed ? `$${fmt2(rPrev.close)}` : "‚Äî"}</div>
                </div>
              </div>

              <div class="footerHint">
                –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ ‚Äú–ò—Å—Ç–æ—Ä–∏–∏‚Äù.
              </div>
            </div>
          </div>
        </div>
      `;

      el.carousel.innerHTML = activeCard + nextCard + laterCard + expiredCard;

      // bind bet buttons
      const betUp = $("#betUp");
      const betDown = $("#betDown");
      if(betUp) betUp.onclick = ()=> openBetModal("UP", next);
      if(betDown) betDown.onclick = ()=> openBetModal("DOWN", next);

      el.footerHint.innerHTML = `
        –ü–æ–¥—Å–∫–∞–∑–∫–∞: —ç—Ç–æ demo-–≤–µ—Ä—Å–∏—è. –¶–µ–Ω–∞ —Å–∏–º—É–ª–∏—Ä—É–µ—Ç—Å—è, —Å—Ç–∞–≤–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ.
      `;
    }

    function calcPoolFor(roundId){
      let up = 0, down = 0;
      for(const b of state.bets){
        if(b.roundId !== roundId) continue;
        if(b.settled) continue;
        if(b.dir === "UP") up += b.amount;
        if(b.dir === "DOWN") down += b.amount;
      }
      return { up:+up.toFixed(2), down:+down.toFixed(2), total:+(up+down).toFixed(2) };
    }

    function renderHistory(){
      // show latest bets + results
      const items = state.bets.slice(0, 30);

      if(items.length === 0){
        el.historyList.innerHTML = `
          <div class="hCard">
            <div style="font-weight:1100;">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</div>
            <div class="hRow" style="margin-top:6px;">
              <span>–°–¥–µ–ª–∞–π —Å—Ç–∞–≤–∫—É –Ω–∞ ‚Äú–ü–æ–ª—ë—Ç–µ‚Äù, –∏ –æ–Ω–∞ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å.</span>
            </div>
          </div>
        `;
        return;
      }

      el.historyList.innerHTML = items.map(b=>{
        const res = state.results[b.roundId];
        const settled = !!b.settled;
        const dirLabel = b.dir === "UP" ? "–í–í–ï–†–•" : "–í–ù–ò–ó";
        const pillStyle = b.dir === "UP"
          ? `border-color: rgba(49,208,170,.30); background: rgba(49,208,170,.14);`
          : `border-color: rgba(237,75,158,.28); background: rgba(237,75,158,.12);`;

        const status = !settled ? "–û–ñ–ò–î–ê–ù–ò–ï" : (b.win ? "–í–´–ò–ì–†–´–®" : "–ü–†–û–ò–ì–†–´–®");
        const statusStyle = !settled
          ? `border-color: rgba(255,255,255,.14); background: rgba(255,255,255,.06);`
          : (b.win
              ? `border-color: rgba(49,208,170,.30); background: rgba(49,208,170,.12);`
              : `border-color: rgba(237,75,158,.28); background: rgba(237,75,158,.10);`);

        const placedAt = new Date(b.placedAt*1000);
        const time = `${pad2(placedAt.getHours())}:${pad2(placedAt.getMinutes())}`;

        return `
          <div class="hCard">
            <div style="display:flex; justify-content:space-between; align-items:center; gap:12px;">
              <div style="font-weight:1100;">–†–∞—É–Ω–¥ #${b.roundId}</div>
              <div class="pillSmall" style="${statusStyle}">${status}</div>
            </div>

            <div class="hRow">
              <span>–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</span>
              <span class="pillSmall" style="${pillStyle}">${dirLabel}</span>
            </div>

            <div class="hRow">
              <span>–°—Ç–∞–≤–∫–∞</span>
              <span><b>${fmt2(b.amount)} TF</b></span>
            </div>

            <div class="hRow">
              <span>–í—Ö–æ–¥</span>
              <span>$${fmt2(b.entryPrice)} ‚Ä¢ ${time}</span>
            </div>

            <div class="hRow">
              <span>–ó–∞–∫—Ä—ã—Ç–∏–µ</span>
              <span>${res && res.close != null ? `$${fmt2(res.close)}` : "‚Äî"}</span>
            </div>

            <div class="hRow">
              <span>–í—ã–ø–ª–∞—Ç–∞</span>
              <span><b>${settled ? fmt2(b.payout) : "‚Äî"} TF</b></span>
            </div>
          </div>
        `;
      }).join("");
    }

    function renderAll(){
      renderPlay();
      renderHistory();
      updateConnectLabel();
    }

    // ===== Screen switching =====
    function setScreen(name){
      const play = (name === "play");
      el.screenPlay.style.display = play ? "" : "none";
      el.screenHistory.style.display = play ? "none" : "";

      el.tabPlay.classList.toggle("active", play);
      el.tabHistory.classList.toggle("active", !play);

      el.navPlay.classList.toggle("active", play);
      el.navHistory.classList.toggle("active", !play);

      if(!play){
        renderHistory();
      }
    }

    el.tabPlay.onclick = ()=>setScreen("play");
    el.tabHistory.onclick = ()=>setScreen("history");
    el.navPlay.onclick = ()=>setScreen("play");
    el.navHistory.onclick = ()=>setScreen("history");

    el.navEarn.onclick = ()=> toast("–ù–∞–≥—Ä–∞–¥—ã: —Å–∫–æ—Ä–æ ‚ú®");
    el.navMe.onclick = ()=> toast("–ü—Ä–æ—Ñ–∏–ª—å: —Å–∫–æ—Ä–æ üë§");

    // ===== Pair switching =====
    $$(".pairMini").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const p = btn.dataset.pair;
        if(!PAIRS[p]) return;
        state.pair = p;

        // reset price close to seed for new pair (demo behavior)
        state.price = PAIRS[p].seed + (Math.random()-0.5)*PAIRS[p].vol*3;
        // start a new open for current round if missing
        const active = roundFor(Date.now());
        ensureRoundResult(active);
        // update open to current on switch (demo)
        state.results[active.id].open = state.price;

        saveState();
        toast(`–ü–∞—Ä–∞: ${PAIRS[p].name}`);
        renderAll();
      });
    });

    // ===== Buttons (stubs) =====
    el.btnHelp.onclick = ()=>{
      openModal("–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç", `
        <div class="footerHint" style="margin-top:0;">
          <b>Tap Flight</b> ‚Äî demo-–ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ü–µ–Ω—ã.
          <br/><br/>
          ‚Ä¢ –†–∞—É–Ω–¥ –¥–ª–∏—Ç—Å—è <b>5 –º–∏–Ω—É—Ç</b>.<br/>
          ‚Ä¢ –°—Ç–∞–≤–∫–∞ –¥–µ–ª–∞–µ—Ç—Å—è –Ω–∞ <b>—Å–ª–µ–¥—É—é—â–∏–π</b> —Ä–∞—É–Ω–¥.<br/>
          ‚Ä¢ –ï—Å–ª–∏ —É–≥–∞–¥–∞–ª –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, –ø–æ–ª—É—á–∞–µ—à—å <b>${PAYOUT}√ó</b> (demo).<br/>
          ‚Ä¢ –í—Å—ë —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ (localStorage).
        </div>
      `, [
        {kind:"primary", text:"–ü–æ–Ω—è—Ç–Ω–æ", onClick: closeModal}
      ]);
    };

    el.btnTrophy.onclick = ()=> toast("–†–µ–π—Ç–∏–Ω–≥: —Å–∫–æ—Ä–æ üèÜ");
    el.btnNetwork.onclick = ()=> toast("–°–µ—Ç—å: BSC (demo)");
    el.btnConnect.onclick = ()=>{
      if(TG && TG.initDataUnsafe && TG.initDataUnsafe.user){
        toast("–¢—ã —É–∂–µ –≤–Ω—É—Ç—Ä–∏ Telegram ‚úÖ");
        return;
      }
      openModal("–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ", `
        <div class="footerHint" style="margin-top:0;">
          –≠—Ç–æ Telegram Mini App. –í–Ω—É—Ç—Ä–∏ Telegram –∏–º—è –ø–æ–¥—Ç—è–Ω–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
          <br/><br/>
          –°–µ–π—á–∞—Å: —Ä–µ–∂–∏–º –±—Ä–∞—É–∑–µ—Ä–∞ (demo).
        </div>
      `, [
        {kind:"ghost", text:"–ó–∞–∫—Ä—ã—Ç—å", onClick: closeModal},
        {kind:"primary", text:"–û–∫", onClick: closeModal},
      ]);
    };

    // ===== Main loop =====
    function tick(){
      stepPrice();

      // keep open for current active round stable once created
      const active = roundFor(Date.now());
      ensureRoundResult(active);

      // persist price occasionally
      saveState();
      renderPlay();
      // history is heavier; refresh less often
    }

    // initial render
    updateConnectLabel();
    renderAll();

    // schedule updates
    setInterval(tick, 1000);
    setInterval(()=>{ renderHistory(); }, 4000);

    // make sure state saves on hide
    document.addEventListener("visibilitychange", ()=>{ if(document.hidden) saveState(); });
    window.addEventListener("beforeunload", saveState);
  </script>
</body>
</html>
